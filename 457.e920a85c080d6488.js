"use strict";(self.webpackChunkcyclops=self.webpackChunkcyclops||[]).push([[457],{6457:(W,I,r)=>{r.r(I),r.d(I,{IssueModule:()=>g});var _=r(6895),v=r(4586),w=r(4004),e=r(4650),Z=r(529),y=r(9646),M=r(1135),U=r(1005),x=r(8505),T=r(8312),q=r(2340);class c{setLoading(s){this.lastSubscription&&this.lastSubscription.unsubscribe();let t=0;s&&(t=0),this.lastSubscription=(0,y.of)(s).pipe((0,U.g)(t)).subscribe(()=>{this.loading.next(s)})}postRequest(s,t={},i=new Z.WM,u=!1){return(0,y.of)(void 0).pipe((0,x.b)(o=>{this.setLoading(!0)}),(0,T.V)(o=>this.http.post(`${this.localUrl}/${s}`,t,{observe:"body",headers:i})),(0,x.b)(o=>{this.setLoading(!1)}))}getRequest(s,t={},i={},u=!1){return(0,y.of)(void 0).pipe((0,x.b)(o=>{this.setLoading(!0)}),(0,T.V)(o=>this.http.get(`${this.localUrl}/${s}`,{observe:"body",params:t,headers:i})),(0,x.b)(o=>{this.setLoading(!1)}))}getBusiness(){return this.getRequest("api/v1/business/?limit=9999999999")}getIssues(s){return this.getRequest("api/v1/issue/list/"+s)}getRevalidateIssues(){return this.getRequest("api/v1/issue/list")}issueUpdate(s,t){return this.postRequest("api/v1/issue/revalidate/"+s,t)}constructor(s){this.http=s,this.localUrl=q.N.url,this.loading=new M.X(!1)}}c.\u0275fac=function(s){return new(s||c)(e.LFG(Z.eN))},c.\u0275prov=e.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"});var A=r(3856),L=r(7731),a=r(9207),b=r(1576),O=r(5829),h=r(4006);class m{transform(s,t,i){return""!=i?s.filter(u=>u[t]==i):s}}function J(n,s){if(1&n&&(e.TgZ(0,"nb-option",18),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",null==t?null:t._id.$oid),e.xp6(1),e.hij(" ",t.name," ")}}function F(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",15)(1,"div",7),e._uU(2," Switch Business "),e.qZA(),e.TgZ(3,"nb-select",16),e.NdJ("selectedChange",function(u){const l=e.CHM(t).ngIf;return e.KtG(l.default_selected=u)})("selectedChange",function(u){e.CHM(t);const o=e.oxw();return e.KtG(o.businessChange(u))}),e.YNc(4,J,2,2,"nb-option",17),e.qZA()()}if(2&n){const t=s.ngIf;e.xp6(3),e.Q6J("selected",t.default_selected),e.xp6(1),e.Q6J("ngForOf",t.data)}}function S(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",19)(1,"nb-card")(2,"nb-select",20),e.NdJ("ngModelChange",function(u){e.CHM(t);const o=e.oxw();return e.KtG(o.query=u)}),e.TgZ(3,"nb-option",18),e._uU(4,"Open"),e.qZA(),e.TgZ(5,"nb-option",18),e._uU(6,"Closed"),e.qZA(),e.TgZ(7,"nb-option",18),e._uU(8,"ReOpen"),e.qZA()()()()}if(2&n){const t=e.oxw();e.xp6(2),e.Q6J("selected",t.status)("ngModel",t.query),e.xp6(1),e.Q6J("value","Open"),e.xp6(2),e.Q6J("value","Closed"),e.xp6(2),e.Q6J("value","ReOpen")}}function P(n,s){1&n&&(e.TgZ(0,"nb-card",23)(1,"nb-card-header")(2,"h1",24),e._uU(3,"No Issues Found"),e.qZA()()())}function N(n,s){if(1&n&&(e.TgZ(0,"th"),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.xp6(1),e.hij(" ",t.title," ")}}function V(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td",27)(2,"span",28),e._UZ(3,"nb-icon",29),e._uU(4),e.qZA()(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td")(14,"nb-icon",30),e.NdJ("click",function(){const o=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.open(o._id.$oid,o.businessId.$oid))}),e.qZA()(),e.TgZ(15,"td")(16,"button",31),e.NdJ("click",function(){const o=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.revalidate(o.issueId.$oid))}),e._uU(17," Revalidate "),e.qZA()()()}if(2&n){const t=s.$implicit;e.xp6(2),e.Q6J("ngClass",t.severity),e.xp6(2),e.hij(" \xa0",t.severity,""),e.xp6(2),e.Oqu(t.issue),e.xp6(2),e.Oqu(t.status),e.xp6(2),e.Oqu(t.projectName),e.xp6(2),e.Oqu(t.doc),e.xp6(4),e.Q6J("disabled",t.disable)}}function $(n,s){if(1&n&&(e.TgZ(0,"nb-card",2)(1,"nb-card-header")(2,"h5"),e._uU(3),e.qZA()(),e.TgZ(4,"nb-card-body",25)(5,"table")(6,"thead")(7,"tr"),e.YNc(8,N,2,1,"th",26),e.qZA()(),e.TgZ(9,"tbody"),e.YNc(10,V,18,7,"tr",26),e.ALo(11,"statusFilter"),e.qZA()()()()),2&n){const t=e.oxw(2);e.xp6(3),e.hij("Issues List ( ",t.businessName," )"),e.xp6(5),e.Q6J("ngForOf",t.columns),e.xp6(2),e.Q6J("ngForOf",e.Dn7(11,3,t.issues,"status",t.query))}}function Q(n,s){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,P,4,0,"nb-card",21),e.YNc(2,$,12,7,"nb-card",22),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",0==t.issues.length),e.xp6(1),e.Q6J("ngIf",t.issues.length>0)}}function R(n,s){1&n&&(e.TgZ(0,"nb-card",23)(1,"nb-card-header")(2,"h1",24),e._uU(3,"No Issues Found to Revalidate"),e.qZA()()())}function G(n,s){if(1&n&&(e.TgZ(0,"th"),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.xp6(1),e.hij(" ",t.title," ")}}function B(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"tr")(1,"td",33)(2,"span",28),e._UZ(3,"nb-icon",29),e._uU(4),e.qZA()(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td")(14,"nb-icon",30),e.NdJ("click",function(){const o=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.open(o._id.$oid,o.businessId.$oid))}),e.qZA()(),e.TgZ(15,"td")(16,"nb-select",34),e.NdJ("selectedChange",function(u){const l=e.CHM(t).$implicit,f=e.oxw(3);return e.KtG(f.statusChange(l.issueId.$oid,u))}),e.TgZ(17,"nb-option",18),e._uU(18,"Open"),e.qZA(),e.TgZ(19,"nb-option",18),e._uU(20,"Closed"),e.qZA(),e.TgZ(21,"nb-option",18),e._uU(22,"ReOpen"),e.qZA()()(),e.TgZ(23,"td")(24,"input",35),e.NdJ("keyup",function(){const o=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.inputChange(o.issueId.$oid,o.comments))})("ngModelChange",function(u){const l=e.CHM(t).$implicit;return e.KtG(l.comments=u)}),e.qZA()()()}if(2&n){const t=s.$implicit;e.xp6(2),e.Q6J("ngClass",t.severity),e.xp6(2),e.hij(" \xa0",t.severity,""),e.xp6(2),e.Oqu(t.issue),e.xp6(2),e.Oqu(t.businessName),e.xp6(2),e.Oqu(t.projectName),e.xp6(2),e.Oqu(t.doc),e.xp6(4),e.Q6J("selected",t.status),e.xp6(1),e.Q6J("value","Revalidate"),e.xp6(2),e.Q6J("value","Closed"),e.xp6(2),e.Q6J("value","ReOpen"),e.xp6(3),e.Q6J("ngModel",t.comments)}}function Y(n,s){if(1&n&&(e.TgZ(0,"nb-card",2)(1,"nb-card-header")(2,"h5"),e._uU(3,"Issues to Revalidate (All Business)"),e.qZA()(),e.TgZ(4,"nb-card-body",25)(5,"table")(6,"thead")(7,"tr"),e.YNc(8,G,2,1,"th",26),e.qZA()(),e.TgZ(9,"tbody"),e.YNc(10,B,25,11,"tr",26),e.qZA()()()()),2&n){const t=e.oxw(2);e.xp6(8),e.Q6J("ngForOf",t.revalidatecolumns),e.xp6(2),e.Q6J("ngForOf",t.revalidateissues)}}function k(n,s){if(1&n&&(e.TgZ(0,"div",32),e.YNc(1,R,4,0,"nb-card",21),e.YNc(2,Y,11,2,"nb-card",22),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",0==t.revalidateissues.length),e.xp6(1),e.Q6J("ngIf",t.revalidateissues.length>0)}}m.\u0275fac=function(s){return new(s||m)},m.\u0275pipe=e.Yjl({name:"statusFilter",type:m,pure:!1});class d{constructor(s,t,i,u,o){this.apiService=s,this.router=t,this.accessChecker=i,this.roleProvider=u,this.routestateservice=o,this.query="",this.issueflag=!0,this.revalidateflag=!0,this.businessList$=this.apiService.getBusiness().pipe((0,w.U)(l=>(console.debug("data",l.default_selected),l.data=l.data.sort((f,C)=>(f=f.name.toLowerCase())<(C=C.name.toLowerCase())?-1:f>C?1:0),l.default_selected=this.routestateservice.businessId?this.routestateservice.businessId:l.data[0]._id.$oid,this.businessChange(l.default_selected),l))),this.columns=[{title:"Risk"},{title:"Vulnerability"},{title:"Status"},{title:"Project"},{title:"Updated On"},{title:"Details"},{title:"Revalidate"}],this.revalidatecolumns=[{title:"Risk"},{title:"Vulnerability"},{title:"Business"},{title:"Project"},{title:"Updated On"},{title:"Details"},{title:"Status"},{title:"Comments"}],this.issues=[],this.revalidateissues=[]}ngOnInit(){this.apiService.getRevalidateIssues().subscribe(s=>{this.revalidateissues=s.data;for(let t of this.revalidateissues)t.doc=new Date(t.doc.$date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/ /g,"-"),t.dou=new Date(t.dou.$date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/ /g,"-"),t.hasOwnProperty("comments")||(t.comments="")})}ngAfterViewInit(){this.roleProvider.getRole().subscribe(s=>{console.log(s),!s.includes("user")||s.includes("superadmin")||s.includes("admin")?s.includes("client")&&!s.includes("superadmin")&&!s.includes("admin")&&(this.issueflag=!0,this.revalidateflag=!1):(this.issueflag=!1,this.revalidateflag=!0)})}businessChange(s){this.query="",this.status=null,this.apiService.getIssues(s).subscribe(t=>{console.log(t.data),this.businessName=t.data[0].businessName,1==t.Status&&(this.issues=t.data);for(let i of this.issues)i.doc=new Date(i.doc.$date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/ /g,"-"),i.dou=new Date(i.dou.$date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"}).replace(/ /g,"-"),i.hasOwnProperty("status")?(i.disable=!1,"Revalidate"==i.status&&(i.status="Open"),("Revalidate"==i.status||"Closed"==i.status)&&(i.disable=!0)):(i.status="Open",i.disable=!1)})}open(s,t){this.routestateservice.businessId=t,this.router.navigate(["app",{outlets:{application:["details",s]}}])}revalidate(s){this.apiService.issueUpdate(s,{status:"Revalidate"}).subscribe(t=>{console.log("")})}statusChange(s,t){this.apiService.issueUpdate(s,{status:t}).subscribe(i=>{console.log("")})}saveComments(s,t){this.apiService.issueUpdate(s,{comments:t}).subscribe(i=>{console.log("")})}inputChange(s,t){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>{this.apiService.issueUpdate(s,{comments:t}).subscribe(i=>{console.log("")})},2e3)}}d.\u0275fac=function(s){return new(s||d)(e.Y36(c),e.Y36(v.F0),e.Y36(A.QH),e.Y36(A.wL),e.Y36(L.U))},d.\u0275cmp=e.Xpm({type:d,selectors:[["app-issue-viewer"]],decls:21,vars:6,consts:[["fixed",""],["fxFlex","","fxLayout","row"],["fxFlex",""],["routerLink","/","nbButton","","ghost","","status","danger","size","large"],["icon","arrow-back-outline"],["fxHide.lt-sm","","fxShow","","routerLink","/",1,"h6"],["status","danger","icon","chevron-right-outline"],[1,"caption-2"],["fxLayoutGap","1rem","fxLayoutAlign","end center","fxFlex","",4,"ngIf"],["fxLayoutAlign","center center"],["fxLayoutAlign","center "],["fxFlex","0 1 1200px","fxLayout","column"],["fxLayoutGap","1rem","fxLayoutAlign","end center",4,"ngIf"],[4,"ngIf"],["fxLayoutGap","1rem",4,"ngIf"],["fxLayoutGap","1rem","fxLayoutAlign","end center","fxFlex",""],["status","success","filled","","placeholder","Select Business","size","small",3,"selected","selectedChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["fxLayoutGap","1rem","fxLayoutAlign","end center"],["status","basic","filled","","placeholder","Select Filter","size","medium",3,"selected","ngModel","ngModelChange"],["fxLayoutGap","1rem","fxFlex","",4,"ngIf"],["fxFlex","",4,"ngIf"],["fxLayoutGap","1rem","fxFlex",""],[1,"heading"],[1,"contains"],[4,"ngFor","ngForOf"],[1,"left"],[3,"ngClass"],["icon","radio-button-on"],["status","success","size","large","icon","log-in-outline",3,"click"],["nbButton","","status","basic","size","small",3,"disabled","click"],["fxLayoutGap","1rem"],[1,"left",2,"white-space","nowrap"],["fullwidth","","status","basic","filled","","size","small",3,"selected","selectedChange"],["nbInput","","placeholder","Write Comments",3,"ngModel","keyup","ngModelChange"]],template:function(s,t){1&s&&(e.TgZ(0,"nb-layout")(1,"nb-layout-header",0)(2,"div",1)(3,"div",2)(4,"button",3),e._UZ(5,"nb-icon",4),e.qZA(),e.TgZ(6,"span",5),e._uU(7," Hawki "),e.qZA(),e._UZ(8,"nb-icon",6),e.TgZ(9,"span",5),e._uU(10," Issue List "),e.TgZ(11,"span",7),e._uU(12,"( Issues )"),e.qZA()()(),e.YNc(13,F,5,2,"div",8),e.ALo(14,"async"),e._UZ(15,"div",9),e.qZA()(),e.TgZ(16,"nb-layout-column",10)(17,"div",11),e.YNc(18,S,9,5,"div",12),e.YNc(19,Q,3,2,"div",13),e.YNc(20,k,3,2,"div",14),e.qZA()()()),2&s&&(e.xp6(13),e.Q6J("ngIf",e.lcZ(14,4,t.issueflag&&t.businessList$)),e.xp6(5),e.Q6J("ngIf",t.issues.length>0&&t.issueflag),e.xp6(1),e.Q6J("ngIf",t.issueflag),e.xp6(1),e.Q6J("ngIf",t.revalidateflag))},dependencies:[v.rH,_.mk,_.sg,_.O5,a.Aqw,a.dP_,a.dmS,a.Asz,a.yKW,a.ndF,a.DPz,b.xw,b.SQ,b.Wh,b.yH,O.b8,O.oO,h.Fj,h.JJ,a.fMN,a.rs,a.q51,h.On,_.Ov,m],styles:[".container[_ngcontent-%COMP%]{display:flex;align-items:center}table[_ngcontent-%COMP%]{border-collapse:collapse;width:100%}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{text-align:center;padding:8px}th[_ngcontent-%COMP%]{background-color:#598bff;color:#fff}td[_ngcontent-%COMP%]{font-size:small}td[_ngcontent-%COMP%]{text-transform:capitalize}tr[_ngcontent-%COMP%]{margin-bottom:1rem}th[_ngcontent-%COMP%]{font-style:bold;color:#000;background:var(--select-filled-basic-background-color);border-color:var(--select-filled-basic-border-color)}.hoverOn[_ngcontent-%COMP%]{background:var(--select-outline-basic-hover-background-color);color:#000}th[_ngcontent-%COMP%]{text-align:center}.content[_ngcontent-%COMP%]{display:flex}.flex[_ngcontent-%COMP%]{flex:1}.Low[_ngcontent-%COMP%]{color:var(--button-filled-primary-background-color)}.Medium[_ngcontent-%COMP%]{color:var(--button-filled-warning-background-color)}.High[_ngcontent-%COMP%]{color:var(--button-filled-danger-background-color)}.Critical[_ngcontent-%COMP%]{color:maroon}.usericon[_ngcontent-%COMP%]{color:var(--color-primary-default)}.left[_ngcontent-%COMP%]{text-align:left}.center[_ngcontent-%COMP%]{text-align:center}.heading[_ngcontent-%COMP%]{font-weight:750;text-align:center}.contains[_ngcontent-%COMP%]{max-height:450px;overflow:auto}"]});const H=[{path:"",component:d},{path:"**",component:d}];class p{}p.\u0275fac=function(s){return new(s||p)},p.\u0275mod=e.oAB({type:p}),p.\u0275inj=e.cJS({imports:[v.Bz.forChild(H),v.Bz]});var j=r(9814),z=r(1483),D=r(6770),K=r(6724);class g{}g.\u0275fac=function(s){return new(s||g)},g.\u0275mod=e.oAB({type:g}),g.\u0275inj=e.cJS({providers:[{provide:Z.TP,useClass:D.n,multi:!0},z.k,c],imports:[p,_.ez,a.BW0,a.EoG,a.zyh,a.T2N,j.o9,h.UX,a.DfH,a.V7y,a.LW9,a.COg,a.KdK,a.BW0,a.uuI,a.IIj,h.u5,K.hy.forRoot({radius:100,outerStrokeWidth:16,innerStrokeWidth:8,outerStrokeColor:"#78C000",innerStrokeColor:"#C7E596",animationDuration:300}),a.EbI]})}}]);